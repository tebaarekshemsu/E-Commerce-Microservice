openapi: 3.0.3
info:
  title: E-Commerce Microservices API Contract
  description: Unified OpenAPI contract for the core microservice ecosystem (Auth, Product, Order, Payment, Notification).
  version: 1.0.0
tags:
  - name: Auth
    description: User registration, login, and profile management.
  - name: Products
    description: Catalog management and inventory lookups.
  - name: Orders
    description: Shopping cart management and order processing.
  - name: Payments
    description: Transaction processing and external webhook handling.
  - name: Notifications (Internal)
    description: Internal endpoint for service-to-service notification delivery.
paths:
  # --- AUTH SERVICE ---
  # --- USER SERVICE ---
  /user-service/api/auth/register/:
    post:
      operationId: auth_register_create
      tags:
      - Auth
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegistrationRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/UserRegistrationRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/UserRegistrationRequest'
        required: true
      responses:
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRegistration'
          description: ''
  /user-service/api/auth/profile/:
    get:
      operationId: auth_profile_retrieve
      tags:
      - Auth
      security:
      - jwtAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
          description: ''
    put:
      operationId: auth_profile_update
      tags:
      - Auth
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/UserRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/UserRequest'
        required: true
      security:
      - jwtAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
          description: ''
    patch:
      operationId: auth_profile_partial_update
      tags:
      - Auth
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchedUserRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/PatchedUserRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/PatchedUserRequest'
      security:
      - jwtAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
          description: ''
  /user-service/api/token/:
    post:
      operationId: token_create
      description: |-
        Takes a set of user credentials and returns an access and refresh JSON web
        token pair to prove the authentication of those credentials.
      tags:
      - Auth
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TokenObtainPairRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/TokenObtainPairRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/TokenObtainPairRequest'
        required: true
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenObtainPair'
          description: ''
  /user-service/api/token/refresh/:
    post:
      operationId: token_refresh_create
      description: |-
        Takes a refresh type JSON web token and returns an access type JSON web
        token if the refresh token is valid.
      tags:
      - Auth
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TokenRefreshRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/TokenRefreshRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/TokenRefreshRequest'
        required: true
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenRefresh'
          description: ''
  /user-service/api/token/verify/:
    post:
      operationId: token_verify_create
      description: |-
        Takes a token and indicates if it is valid.  This view provides no
        information about a token's fitness for a particular use.
      tags:
      - Auth
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TokenVerifyRequest'
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/TokenVerifyRequest'
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/TokenVerifyRequest'
        required: true
      responses:
        '200':
          description: No response body

  # --- PRODUCT SERVICE ---
  /product-service/api/products:
    get:
      tags: [Products]
      summary: List all products
      responses:
        "200":
          description: A list of products.
          content:
            application/json:
              schema:
                type: object
                properties:
                  collection:
                    type: array
                    items:
                      $ref: "#/components/schemas/Product"
    post:
      tags: [Products]
      summary: Create a new product (Admin access required)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProductCreateRequest"
      responses:
        "201":
          description: Product created successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Product"
        "401":
          description: Unauthorized

  /product-service/api/products/{productId}:
    get:
      tags: [Products]
      summary: Get a product by ID
      parameters:
        - in: path
          name: productId
          schema:
            type: integer
          required: true
          description: ID of the product to retrieve
      responses:
        "200":
          description: Product details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Product"
        "404":
          description: Product not found
    put:
      tags: [Products]
      summary: Update a product by ID (Admin access required)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: productId
          schema:
            type: integer
          required: true
          description: ID of the product to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProductCreateRequest"
      responses:
        "200":
          description: Product updated successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Product"
        "401":
          description: Unauthorized
        "404":
          description: Product not found
    delete:
      tags: [Products]
      summary: Delete a product by ID (Admin access required)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: productId
          schema:
            type: integer
          required: true
          description: ID of the product to delete
      responses:
        "200":
          description: Product deleted successfully.
        "401":
          description: Unauthorized
        "404":
          description: Product not found

  /product-service/api/categories:
    get:
      tags: [Products]
      summary: List all categories
      responses:
        "200":
          description: A list of categories.
          content:
            application/json:
              schema:
                type: object
                properties:
                  collection:
                    type: array
                    items:
                      $ref: "#/components/schemas/Category"
    post:
      tags: [Products]
      summary: Create a new category (Admin access required)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CategoryCreateRequest"
      responses:
        "201":
          description: Category created successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Category"
        "401":
          description: Unauthorized

  /product-service/api/categories/{categoryId}:
    get:
      tags: [Products]
      summary: Get a category by ID
      parameters:
        - in: path
          name: categoryId
          schema:
            type: integer
          required: true
          description: ID of the category to retrieve
      responses:
        "200":
          description: Category details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Category"
        "404":
          description: Category not found
    put:
      tags: [Products]
      summary: Update a category by ID (Admin access required)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: categoryId
          schema:
            type: integer
          required: true
          description: ID of the category to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CategoryCreateRequest"
      responses:
        "200":
          description: Category updated successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Category"
        "401":
          description: Unauthorized
        "404":
          description: Category not found
    delete:
      tags: [Products]
      summary: Delete a category by ID (Admin access required)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: categoryId
          schema:
            type: integer
          required: true
          description: ID of the category to delete
      responses:
        "200":
          description: Category deleted successfully.
        "401":
          description: Unauthorized
        "404":
          description: Category not found

  # --- ORDER SERVICE (Node/Express) ---
  /order-service/api/orders:
    get:
      tags: [Orders]
      summary: List all orders
      responses:
        "200":
          description: Collection of orders.
          content:
            application/json:
              schema:
                type: object
                properties:
                  collection:
                    type: array
                    items:
                      $ref: "#/components/schemas/Order"
    post:
      tags: [Orders]
      summary: Create a new order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OrderRequest"
      responses:
        "200":
          description: Order created successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    put:
      tags: [Orders]
      summary: Update an order by payload `orderId`
      requestBody:
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: "#/components/schemas/OrderRequest"
                - type: object
                  required: [orderId]
                  properties:
                    orderId:
                      type: string
                      description: Existing order ID to update.
      responses:
        "200":
          description: Order updated successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        "400":
          description: Validation or not-found error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /order-service/api/orders/{orderId}:
    get:
      tags: [Orders]
      summary: Get an order by ID
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            description: Order ID (Mongo ObjectId)
      responses:
        "200":
          description: Order details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        "400":
          description: Invalid or not-found order ID
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    put:
      tags: [Orders]
      summary: Update an order by path `orderId`
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            description: Order ID (Mongo ObjectId)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OrderRequest"
      responses:
        "200":
          description: Order updated successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
        "400":
          description: Validation or not-found error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    delete:
      tags: [Orders]
      summary: Delete an order by ID
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            description: Order ID (Mongo ObjectId)
      responses:
        "200":
          description: Deletion succeeded. Returns boolean `true`.
          content:
            application/json:
              schema:
                type: boolean
        "400":
          description: Invalid or not-found order ID
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /order-service/api/carts:
    get:
      tags: [Orders]
      summary: List all carts
      responses:
        "200":
          description: Collection of carts.
          content:
            application/json:
              schema:
                type: object
                properties:
                  collection:
                    type: array
                    items:
                      $ref: "#/components/schemas/Cart"
    post:
      tags: [Orders]
      summary: Create a new cart
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CartRequest"
      responses:
        "200":
          description: Cart created successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Cart"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    put:
      tags: [Orders]
      summary: Update a cart by payload `cartId`
      requestBody:
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: "#/components/schemas/CartRequest"
                - type: object
                  required: [cartId]
                  properties:
                    cartId:
                      type: string
                      description: Existing cart ID to update.
      responses:
        "200":
          description: Cart updated successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Cart"
        "400":
          description: Validation or not-found error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /order-service/api/carts/{cartId}:
    get:
      tags: [Orders]
      summary: Get a cart by ID
      parameters:
        - name: cartId
          in: path
          required: true
          schema:
            type: string
            description: Cart ID (Mongo ObjectId)
      responses:
        "200":
          description: Cart details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Cart"
        "400":
          description: Invalid or not-found cart ID
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    put:
      tags: [Orders]
      summary: Update a cart by path `cartId`
      parameters:
        - name: cartId
          in: path
          required: true
          schema:
            type: string
            description: Cart ID (Mongo ObjectId)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CartRequest"
      responses:
        "200":
          description: Cart updated successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Cart"
        "400":
          description: Validation or not-found error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    delete:
      tags: [Orders]
      summary: Delete a cart by ID
      parameters:
        - name: cartId
          in: path
          required: true
          schema:
            type: string
            description: Cart ID (Mongo ObjectId)
      responses:
        "200":
          description: Deletion succeeded. Returns boolean `true`.
          content:
            application/json:
              schema:
                type: boolean
        "400":
          description: Invalid or not-found cart ID
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  # --- PAYMENT SERVICE ---
  /payment-service/api/payments:
    get:
      tags: [Payments]
      summary: List all payments
      responses:
        "200":
          description: A list of payments.
          content:
            application/json:
              schema:
                type: object
                properties:
                  collection:
                    type: array
                    items:
                      $ref: "#/components/schemas/Payment"
    post:
      tags: [Payments]
      summary: Create a new payment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PaymentInitiationRequest"
      responses:
        "201":
          description: Payment created successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Payment"
    put:
      tags: [Payments]
      summary: Update a payment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Payment"
      responses:
        "200":
          description: Payment updated successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Payment"

  /payment-service/api/payments/{paymentId}:
    get:
      tags: [Payments]
      summary: Get a payment by ID
      parameters:
        - in: path
          name: paymentId
          schema:
            type: integer
          required: true
          description: ID of the payment to retrieve
      responses:
        "200":
          description: Payment details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Payment"
        "404":
          description: Payment not found
    delete:
      tags: [Payments]
      summary: Delete a payment by ID
      parameters:
        - in: path
          name: paymentId
          schema:
            type: integer
          required: true
          description: ID of the payment to delete
      responses:
        "200":
          description: Payment deleted successfully.
        "404":
          description: Payment not found

  # --- NOTIFICATION SERVICE (INTERNAL) ---
  /notifications/send:
    post:
      tags: [Notifications (Internal)]
      summary: Send internal notification (e.g., email or push)
      description: This endpoint should only be called by other microservices (e.g., Payment Service after success).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NotificationRequest"
      responses:
        "202":
          description: Notification accepted for processing.

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    jwtAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Address:
      type: object
      properties:
        full_address:
          type: string
          maxLength: 255
        postal_code:
          type: string
          nullable: true
          maxLength: 20
        city:
          type: string
          maxLength: 100
      required:
      - city
      - full_address
    AddressRequest:
      type: object
      properties:
        full_address:
          type: string
          minLength: 1
          maxLength: 255
        postal_code:
          type: string
          nullable: true
          maxLength: 20
        city:
          type: string
          minLength: 1
          maxLength: 100
      required:
      - city
      - full_address
    PatchedUserRequest:
      type: object
      properties:
        username:
          type: string
          minLength: 1
          description: Required. 150 characters or fewer. Letters, digits and @/./+/-/_
            only.
          pattern: ^[\w.@+-]+$
          maxLength: 150
        email:
          type: string
          format: email
          minLength: 1
          maxLength: 254
        first_name:
          type: string
          maxLength: 150
        last_name:
          type: string
          maxLength: 150
        phone:
          type: string
          nullable: true
          maxLength: 50
        image_url:
          type: string
          nullable: true
          maxLength: 255
        role:
          $ref: '#/components/schemas/RoleEnum'
    RoleEnum:
      enum:
      - ADMIN
      - USER
      type: string
      description: |-
        * `ADMIN` - Admin
        * `USER` - User
    TokenObtainPair:
      type: object
      properties:
        access:
          type: string
          readOnly: true
        refresh:
          type: string
          readOnly: true
      required:
      - access
      - refresh
    TokenObtainPairRequest:
      type: object
      properties:
        username:
          type: string
          writeOnly: true
          minLength: 1
        password:
          type: string
          writeOnly: true
          minLength: 1
      required:
      - password
      - username
    TokenRefresh:
      type: object
      properties:
        access:
          type: string
          readOnly: true
      required:
      - access
    TokenRefreshRequest:
      type: object
      properties:
        refresh:
          type: string
          writeOnly: true
          minLength: 1
      required:
      - refresh
    TokenVerifyRequest:
      type: object
      properties:
        token:
          type: string
          writeOnly: true
          minLength: 1
      required:
      - token
    User:
      type: object
      properties:
        id:
          type: integer
          readOnly: true
        username:
          type: string
          description: Required. 150 characters or fewer. Letters, digits and @/./+/-/_
            only.
          pattern: ^[\w.@+-]+$
          maxLength: 150
        email:
          type: string
          format: email
          maxLength: 254
        first_name:
          type: string
          maxLength: 150
        last_name:
          type: string
          maxLength: 150
        phone:
          type: string
          nullable: true
          maxLength: 50
        image_url:
          type: string
          nullable: true
          maxLength: 255
        role:
          $ref: '#/components/schemas/RoleEnum'
        addresses:
          type: array
          items:
            $ref: '#/components/schemas/Address'
          readOnly: true
      required:
      - addresses
      - email
      - id
      - username
    UserRegistration:
      type: object
      properties:
        email:
          type: string
          format: email
          maxLength: 254
        username:
          type: string
          description: Required. 150 characters or fewer. Letters, digits and @/./+/-/_
            only.
          pattern: ^[\w.@+-]+$
          maxLength: 150
      required:
      - email
      - username
    UserRegistrationRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          minLength: 1
          maxLength: 254
        username:
          type: string
          minLength: 1
          description: Required. 150 characters or fewer. Letters, digits and @/./+/-/_
            only.
          pattern: ^[\w.@+-]+$
          maxLength: 150
        password:
          type: string
          writeOnly: true
          minLength: 1
          maxLength: 128
        confirm_password:
          type: string
          writeOnly: true
          minLength: 1
      required:
      - confirm_password
      - email
      - password
      - username
    UserRequest:
      type: object
      properties:
        username:
          type: string
          minLength: 1
          description: Required. 150 characters or fewer. Letters, digits and @/./+/-/_
            only.
          pattern: ^[\w.@+-]+$
          maxLength: 150
        email:
          type: string
          format: email
          minLength: 1
          maxLength: 254
        first_name:
          type: string
          maxLength: 150
        last_name:
          type: string
          maxLength: 150
        phone:
          type: string
          nullable: true
          maxLength: 50
        image_url:
          type: string
          nullable: true
          maxLength: 255
        role:
          $ref: '#/components/schemas/RoleEnum'
      required:
      - email
      - username
    Product:
      type: object
      properties:
        productId: { type: integer, example: 550 }
        productTitle: { type: string, example: "Wireless Keyboard" }
        imageUrl: { type: string, example: "http://example.com/image.jpg" }
        sku: { type: string, example: "KB-123" }
        priceUnit: { type: number, format: float, example: 45.99 }
        quantity: { type: integer, example: 120 }
        category: { $ref: "#/components/schemas/Category" }
    Category:
      type: object
      properties:
        categoryId: { type: integer, example: 10 }
        categoryTitle: { type: string, example: "Electronics" }
        imageUrl: { type: string, example: "http://example.com/cat.jpg" }
        parentCategory: { $ref: "#/components/schemas/Category" }
    ProductCreateRequest:
      type: object
      required: [productTitle, priceUnit, quantity]
      properties:
        productTitle: { type: string }
        imageUrl: { type: string }
        sku: { type: string }
        priceUnit: { type: number, format: float }
        quantity: { type: integer }
        categoryId: { type: integer }
    CategoryCreateRequest:
      type: object
      required: [categoryTitle]
      properties:
        categoryTitle: { type: string }
        imageUrl: { type: string }
        parentCategoryId: { type: integer }
    PaymentInitiationRequest:
      type: object
      required: [order_id]
      properties:
        order_id: { type: integer, example: 8821 }
        payment_method:
          type: string
          enum: [credit_card, paypal]
          example: credit_card
    OrderRequest:
      type: object
      description: Order payload. At least one property should be provided.
      properties:
        orderDate:
          type: string
          format: date-time
          example: "2024-01-31T12:34:56.000Z"
        orderDesc:
          type: string
          maxLength: 255
          example: "Order for electronics"
        orderFee:
          type: number
          format: float
          example: 49.99
        cart:
          $ref: "#/components/schemas/CartReference"

    Order:
      type: object
      properties:
        orderId:
          type: string
          description: Order ID (Mongo ObjectId)
          example: "6650b0d1c25f1f3e0a123456"
        orderDate:
          type: string
          format: date-time
        orderDesc:
          type: string
        orderFee:
          type: number
          format: float
        cart:
          $ref: "#/components/schemas/CartReference"

    CartRequest:
      type: object
      description: Cart payload. At least one property should be provided.
      properties:
        userId:
          type: integer
          example: 42

    Cart:
      type: object
      properties:
        cartId:
          type: string
          description: Cart ID (Mongo ObjectId)
          example: "6650b10dc25f1f3e0a654321"
        userId:
          type: integer
          nullable: true
        user:
          $ref: "#/components/schemas/CartUser"

    CartReference:
      type: object
      properties:
        cartId:
          type: string
          description: Cart ID (Mongo ObjectId)
          example: "6650b10dc25f1f3e0a654321"

    CartUser:
      type: object
      properties:
        userId: { type: integer, example: 42 }
        firstName: { type: string, example: "John" }
        lastName: { type: string, example: "Doe" }
        imageUrl: { type: string, example: "https://example.com/avatar.jpg" }
        email: { type: string, format: email }
        phone: { type: string, example: "+15551234567" }

    ErrorResponse:
      type: object
      properties:
        msg: { type: string, example: "*Invalid JSON format!**" }
        httpStatus: { type: integer, example: 400 }
        timestamp: { type: string, format: date-time }
