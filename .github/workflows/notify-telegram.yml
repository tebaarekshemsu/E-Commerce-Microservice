name: Telegram Notify

on:
  push:
    branches: [main]

jobs:
  notify:
    runs-on: ubuntu-latest
    env:
      TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
      TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      GITHUB_ACTOR: ${{ github.actor }}
      GITHUB_SHA: ${{ github.sha }}
      GITHUB_MESSAGE: ${{ github.event.head_commit.message }}
      GITHUB_REPO: ${{ github.repository }}
    steps:
      - name: Notify Telegram on Push
        run: |
          MESSAGE="üöÄ *New Push to main*\n\
          üë§ Author: \`${GITHUB_ACTOR}\`\n\
          üÜî Commit: \`${GITHUB_SHA}\`\n\
          üìù Message: _${GITHUB_MESSAGE}_\n\
          üîó Repo: ${GITHUB_REPO}"

          curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
            -d chat_id="${TELEGRAM_CHAT_ID}" \
            -d parse_mode="Markdown" \
            --data-urlencode text="$MESSAGE"
